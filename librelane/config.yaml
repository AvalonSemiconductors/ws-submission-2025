meta:
  version: 2
  flow: Classic
  substituting_steps:
    # Padring is used instead of pins
    OpenROAD.IOPlacement: null
    +Odb.SetPowerConnections: OpenROAD.Padring
    OpenROAD.TapEndcapInsertion: null
    OpenROAD.RepairDesignPostGpl: null
    Odb.ManualGlobalPlacement: null
    OpenROAD.CTS: null
    OpenROAD.STAMidPnr-1: null
    OpenROAD.ResizerTimingPostCTS: null
    OpenROAD.STAMidPnr-2: null
    OpenROAD.CheckAntennas: null
    Odb.DiodesOnPorts: null
    OpenROAD.RepairAntennas: null
    OpenROAD.STAMidPnr: null
    OpenROAD.CheckAntennas: null
    OpenROAD.FillInsertion: null
    
    # Add the seal ring
    +Checker.XOR: KLayout.SealRing
    
    # Run filler insertion
    +KLayout.SealRing: KLayout.FillerGeneration
    
    # Check the density across the layers
    +KLayout.FillerGeneration: KLayout.RunDensity
    +KLayout.RunDensity: Checker.Density
    
    # Due to OpenROAD bug
    # https://github.com/The-OpenROAD-Project/OpenROAD/issues/8229
    #TODO OpenROAD.Repair*: null
    
    # Not supported for gf180mcu
    KLayout.DRC: null
    Checker.KLayoutDRC: null
    
    # Save time
    #OpenROAD.IRDropReport: null
    #Magic.DRC: null
    #Checker.MagicDRC: null
    #KLayout.XOR: null
    
    # Stuck, need to investigate...
    #Netgen.LVS: null
    #Checker.LVS: null
    
    Magic.WriteLEF: null # Not needed, save time
    Odb.CheckDesignAntennaProperties: null # Requires LEF

DESIGN_NAME: chip_top
VERILOG_FILES:
- dir::../src/chip_top.sv

# Enable plugin for better SystemVerilog support
# USE_SLANG: True

# Slightly smaller file sizes
PRIMARY_GDSII_STREAMOUT_TOOL: klayout

# Specify the pad instances for the padring
PAD_SOUTH: [
    clk_pad,
    rst_n_pad,

    "bidir\\[0\\].pad",
    "bidir\\[1\\].pad",
    "bidir\\[2\\].pad",
    "bidir\\[3\\].pad",
    "bidir\\[4\\].pad",
    "bidir\\[5\\].pad",

    dvss_south_0,

    "bidir\\[6\\].pad",
    "bidir\\[7\\].pad",
    "bidir\\[8\\].pad",
    "bidir\\[9\\].pad",
    "bidir\\[10\\].pad",
    "bidir\\[11\\].pad",
    "bidir\\[12\\].pad",
    "bidir\\[13\\].pad"
]

PAD_EAST: [
    dvdd_east_0,
    dvss_east_0,

    "bidir\\[14\\].pad",
    "bidir\\[15\\].pad",
    "bidir\\[16\\].pad",
    "bidir\\[17\\].pad",
    "bidir\\[18\\].pad",
    "bidir\\[19\\].pad",
    
    dvdd_east_1,
    dvss_east_1,

    
    "bidir\\[20\\].pad",
    "bidir\\[21\\].pad",
    "bidir\\[22\\].pad",
    "bidir\\[23\\].pad",
    "bidir\\[24\\].pad",
    "bidir\\[25\\].pad",
    
    dvss_east_2,
    dvdd_east_2,
    dvss_east_3,
    dvdd_east_3
]

PAD_NORTH: [
    "bidir\\[41\\].pad",
    "bidir\\[40\\].pad",
    "bidir\\[39\\].pad",
    "bidir\\[38\\].pad",
    "bidir\\[37\\].pad",
    "bidir\\[36\\].pad",
    "bidir\\[35\\].pad",
    "bidir\\[34\\].pad",

    dvss_north_0,

    "bidir\\[33\\].pad",
    "bidir\\[32\\].pad",
    "bidir\\[31\\].pad",
    "bidir\\[30\\].pad",
    "bidir\\[29\\].pad",
    "bidir\\[28\\].pad",
    "bidir\\[27\\].pad",
    "bidir\\[26\\].pad"
]


PAD_WEST: [
    dvdd_west_3,
    dvss_west_3,
    dvdd_west_2,
    dvss_west_2,

    "bidir\\[53\\].pad",
    "bidir\\[52\\].pad",
    "bidir\\[51\\].pad",
    "bidir\\[50\\].pad",
    "bidir\\[49\\].pad",
    "bidir\\[48\\].pad",

    dvdd_west_1,
    dvss_west_1,

    "bidir\\[47\\].pad",
    "bidir\\[46\\].pad",
    "bidir\\[45\\].pad",
    "bidir\\[44\\].pad",

    dvdd_west_0,
    dvss_west_0,
    
    "bidir\\[43\\].pad",
    "bidir\\[42\\].pad"
]

# SDC files
PNR_SDC_FILE: dir::constraint.sdc
SIGNOFF_SDC_FILE: dir::constraint.sdc
FALLBACK_SDC: dir::constraint.sdc

# Power / ground nets
VDD_NETS:
- VDD
GND_NETS:
- VSS

# We need to add gf180mcu_fd_io__bi_24t
# due to the unused Y output for output only pads
IGNORE_DISCONNECTED_MODULES:
- gf180mcu_fd_io__bi_24t
- avali_logo

# Clock
CLOCK_PORT: clk_PAD
CLOCK_PERIOD: 20

# Floorplanning
FP_SIZING: absolute
# 3880umx5070um including 26um
# for the sealring on all sides
DIE_AREA: [0, 0, 3932, 5122]
CORE_AREA: [442, 442, 3490, 4680]

# Increase for more logic
# on your die
PL_TARGET_DENSITY_PCT: 35
RT_MAX_LAYER: Metal5

# PDN
PDN_MULTILAYER: True
PDN_CORE_RING: True
PDN_ENABLE_RAILS: False
# Maximum metal width without slotting: 30um
PDN_CORE_RING_VWIDTH: 5
PDN_CORE_RING_HWIDTH: 5
PDN_CORE_RING_VOFFSET: 3
PDN_CORE_RING_HOFFSET: 3
PDN_CORE_RING_VSPACING: 2
PDN_CORE_RING_HSPACING: 2
PDN_HPITCH: 28
PDN_VPITCH: 28
PDN_CORE_RING_CONNECT_TO_PADS: True
PDN_MACRO_CONNECTIONS: ["user_project_example VDD VSS VDD VSS"]
PDN_ENABLE_PINS: True
PDN_CORE_VERTICAL_LAYER: Metal2
PDN_CORE_HORIZONTAL_LAYER: Metal3

# Due to OpenROAD bug
# https://github.com/The-OpenROAD-Project/OpenROAD/issues/8229
#PL_TIME_DRIVEN: False
#PL_ROUTABILITY_DRIVEN: False

# Prevent false positive DRC errors in I/O cells
MAGIC_GDS_FLATGLOB:
# For contacts
- "*_CDNS_*"
# COMP and Poly2 filler cells need to be 
# flattened to form a "filltrans" layer
- "COMP_fill_cell"
- "Poly2_fill_cell"

# Because we have multiple power pads for one power domain
MAGIC_EXT_UNIQUE: notopports

MACROS:
  user_project_example:
    gds:
      - dir::../example_project/runs/latest/final/gds/user_project_example.gds
    lef:
      - dir::../example_project/runs/latest/final/lef/user_project_example.lef
    pnl:
      - dir::../example_project/runs/latest/final/pnl/user_project_example.pnl.v
    nl:
      - dir::../example_project/runs/latest/final/nl/user_project_example.nl.v
    spef:
      min_*: dir::../example_project/runs/latest/final/spef/min/user_project_example.min.spef
      nom_*: dir::../example_project/runs/latest/final/spef/nom/user_project_example.nom.spef
      max_*: dir::../example_project/runs/latest/final/spef/max/user_project_example.max.spef
    lib:
      max_ff_n40C_5v50: dir::../example_project/runs/latest/final/lib/max_ff_n40C_5v50/user_project_example__max_ff_n40C_5v50.lib
      max_ss_125C_4v50: dir::../example_project/runs/latest/final/lib/max_ss_125C_4v50/user_project_example__max_ss_125C_4v50.lib
      max_tt_025C_5v00: dir::../example_project/runs/latest/final/lib/max_tt_025C_5v00/user_project_example__max_tt_025C_5v00.lib
      min_ff_n40C_5v50: dir::../example_project/runs/latest/final/lib/min_ff_n40C_5v50/user_project_example__min_ff_n40C_5v50.lib
      min_ss_125C_4v50: dir::../example_project/runs/latest/final/lib/min_ss_125C_4v50/user_project_example__min_ss_125C_4v50.lib
      min_tt_025C_5v00: dir::../example_project/runs/latest/final/lib/min_tt_025C_5v00/user_project_example__min_tt_025C_5v00.lib
      nom_ff_n40C_5v50: dir::../example_project/runs/latest/final/lib/nom_ff_n40C_5v50/user_project_example__nom_ff_n40C_5v50.lib
      nom_ss_125C_4v50: dir::../example_project/runs/latest/final/lib/nom_ss_125C_4v50/user_project_example__nom_ss_125C_4v50.lib
      nom_tt_025C_5v00: dir::../example_project/runs/latest/final/lib/nom_tt_025C_5v00/user_project_example__nom_tt_025C_5v00.lib
    instances:
      user_project_example:
        location: [1000, 1000]
        orientation: N
  gf180mcu_ws_ip__id:
    gds:
      - dir::../ip/gf180mcu_ws_ip__id/gds/gf180mcu_ws_ip__id.gds
    lef:
      - dir::../ip/gf180mcu_ws_ip__id/lef/gf180mcu_ws_ip__id.lef
    nl:
      - dir::../ip/gf180mcu_ws_ip__id/rtl/gf180mcu_ws_ip__id.v
    instances:
      die_id:
        location: [26, 26]
        orientation: N
  avali_logo:
    gds:
      - dir::../silicon_art/avali_logo.gds
    lef:
      - dir::../silicon_art/avali_logo.lef
    nl:
      - dir::../silicon_art/avali_logo.v
    instances:
      avali_logo:
        location: [571, 3987]
        orientation: N

# Make sure netgen doesn't create 'no_connect' nets
# Not needed since netgen 1.5.303
LVS_FLATTEN_CELLS:
- gf180mcu_ws_ip__id
- avali_logo

# gf180mcu_ws_ip__id has no ports and components
# therefore make it an abstract cell in the layout
MAGIC_EXT_ABSTRACT_CELLS:
- gf180mcu_ws_ip__id
- avali_logo
